# My time tracker BI

Проект по ELT данных для анализа активностей пользователей на рабочем столе компьютера. 

Составные части систменой архитектуры проекта:
Airbyte - используется для загрузки данных из базы данных серверного приложения сборщика активностей в DWH.
Postgres - как СУБД для DWH проекта и системной базы данных для Metabse
Cube - для создания сементического слоя для аналитики ключевых метрик
Metabase - для построения витрин bi
Docker + Docker Compose - для создания среды работы решения с помощью развертывания контейнеров для работы вышеперечисленных систем.

## Установка Airbyte

Релизы https://github.com/airbytehq/airbyte/releases

Для данного решения была использована версия 0.50.37, так как последняя версия из-за неизвестной ошибки не смогла загрузить схему данных источника.

Установка в Docker Compose https://docs.airbyte.com/deploying-airbyte/docker-compose


## Установка других систем окружения

 Оставшиеся системы устанавливаются в Docker Compose и сконфигурированы в [Docker containers](./docker-compose.yml).


## Конфигурирвоание Airbyte pipeline для загрузки данных в DWH

![Схема таблиц источника данных](./docs/source_data_schema.png)

Airbyte pipeline настройки
Загрука построена по incremental стратегии
![Настройки Airbyte pipeline](./docs/airflow_pipeline_settings.png)

Пример работы pipeline
![История Airbyte pipeline](./docs/airbyte_pipeline_history.png)


## Трасформация исходных данных

### Staging слой

В данном слое создаются 2 модели
1) stg_singletracks_dedup - эта модель организована для решения проблемы дублирующихся записей, в которой происходит нахождение и удаление дублей в src таблицах перекаченных из источника в dwh.
Дополнительно реализована incremental стратегия обработки данных.
2) stg_applications_by_processfilepath - в данной модели происходит сопоставление названий приложений и типов приложений, используемых пользователями, по пути к файлу запущенных на компьютерах процессов.

### Intermediate

int_person_activities - модель  с материализацие view. В модели данные обогащаются связями для определения имен пользователей, названий приложений и их типов, групп пользователей

### Mart

mart_person_activity_hour_facts - расчитывается витрина данных с агрегацией времени активности по измерениями с гранулярностью - час.


## Конфигурирование метрик Cube

Модель описана [Cube model](./model/cubes/personactivity_cube_model.yml)
![Cube модель измерений и метрик](./docs/cube_metrics_model.png)


## Визуализация на dashboard Metabase

Для визауализации используется Metabase

![Пример настроенной витрины](./docs/metabase_dashboard.png)